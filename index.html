<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>易經數字計算</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #e0f7fa;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 500px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #00796b;
        }
        label {
            display: block;
            margin-top: 15px;
        }
        input {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            margin-top: 20px;
            width: 100%;
            padding: 10px;
            background-color: #00796b;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #004d40;
        }
        pre {
            background: #f1f1f1;
            padding: 10px;
            border-radius: 5px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>[ 易經數字 ]</h1>
        <label>身分證號：</label>
        <input type="text" id="idNumber" placeholder="例如 A229156253">
        <label>出生日期：</label>
        <input type="date" id="birthDate">
        <button onclick="calculate()">計算</button>
        <pre id="result"></pre>
    </div>

    <script>
        const letterMap = {
            A: 11, B: 12, C: 13, D: 14, E: 15, F: 16, G: 17, H: 18, I: 19, J: 20,
            K: 21, L: 22, M: 23, N: 24, O: 25, P: 26, Q: 27, R: 28, S: 29, T: 30,
            U: 31, V: 32, W: 33, X: 34, Y: 35, Z: 36
        };
        const meaningMap = {
            "11": "伏位", "12": "絕命", "13": "生氣", "14": "天醫",
            "15": "禍害", "16": "六煞", "17": "延年", "18": "生氣",
            "19": "天醫", "20": "伏位", "21": "禍害", "22": "伏位",
            "23": "禍害", "24": "天醫", "25": "絕命", "26": "生氣",
            "27": "延年", "28": "天醫", "29": "六煞", "30": "伏位",
            "31": "延年", "32": "生氣", "33": "伏位", "34": "天醫",
            "35": "絕命", "36": "禍害", "91": "延年", "66": "伏位"
        };
        function calculate() {
            const id = document.getElementById('idNumber').value.trim().toUpperCase();
            const birth = document.getElementById('birthDate').value;
            if (!id || !birth) {
                alert("請輸入身分證號與出生日期");
                return;
            }
            const birthYear = new Date(birth).getFullYear();
            const age = new Date().getFullYear() - birthYear;
            let numbers = [];
            let prevNum = letterMap[id[0]];
            numbers.push(prevNum);
            for (let i = 1; i < id.length; i++) {
                let cur = parseInt(id[i]);
                if (cur === 0) {
                    numbers.push(prevNum);
                } else if (cur === 5) {
                    numbers.push(parseInt(id[i+1]) ? parseInt(id[i+1]) + prevNum - prevNum + parseInt(id[i+1]) : prevNum);
                } else {
                    let numStr = "" + prevNum.toString().slice(-1) + cur;
                    numbers.push(parseInt(numStr));
                    prevNum = cur;
                }
            }
            const ageRanges = [
                [0,10],[10,15],[15,20],[20,25],[25,30],
                [30,35],[35,40],[40,45],[45,50],[50,70]
            ];
            let output = "";
            ageRanges.forEach((range, idx) => {
                let val = numbers[idx];
                output += `${range[0]}-${range[1]}：${val} ${meaningMap[val] || ""}\n`;
            });
            let counts = {};
            numbers.forEach(num => {
                let meaning = meaningMap[num] || "";
                if (!counts[meaning]) counts[meaning] = 0;
                counts[meaning]++;
            });
            let mainLife = Object.keys(counts).reduce((a,b)=> counts[a]>counts[b]?a:b);
            let currentPeriod = ageRanges.findIndex(r => age >= r[0] && age < r[1]);
            let currentMeaning = meaningMap[numbers[currentPeriod]] || "";
            output += `\n【排列結果】\n本命：${mainLife}\n流年：${currentMeaning}`;
            document.getElementById('result').innerText = output;
        }
    </script>
</body>
</html>
